@model ProgettoIUM.Web.Features.Compilazione.CompilazioneViewModel

<div class="container py-5">
    <div class="text-center mb-4">
        <h2 class="fw-bold">Riepilogo dati inseriti</h2>
    </div>

    <div class="custom-gray-card shadow-lg p-5 rounded-5 mx-auto mb-5" style="max-width: 900px; background-color: #fcfcfc; border: 1px solid #eee;">
        <div class="row gy-4 px-lg-4">
            <div class="col-md-6">
                <label class="text-muted small text-uppercase fw-bold d-block mb-1">Categoria Illecito</label>
                <div class="p-3 bg-white border rounded-3 shadow-sm">
                    <i class="fa-solid fa-tag text-primary me-2"></i> @Model.Categoria
                </div>
            </div>

            <div class="col-md-6">
                <label class="text-muted small text-uppercase fw-bold d-block mb-1">Data e Ora</label>
                <div class="p-3 bg-white border rounded-3 shadow-sm">
                    <i class="fa-solid fa-calendar-days text-success me-2"></i> @Model.DataInvio.ToString("yyyy/MM/dd HH:mm")
                </div>
            </div>

            <div class="col-md-6">
                <label class="text-muted small text-uppercase fw-bold d-block mb-1">Luogo</label>
                <div class="p-3 bg-white border rounded-3 shadow-sm">
                    <i class="fa-solid fa-location-dot text-danger me-2"></i> @Model.Luogo
                </div>
            </div>

            <div class="col-md-6">
                <label class="text-muted small text-uppercase fw-bold d-block mb-1">Reparto</label>
                <div class="p-3 bg-white border rounded-3 shadow-sm">
                    <i class="fa-solid fa-building text-warning me-2"></i> @Model.Reparto
                </div>
            </div>

            <div class="col-12">
                <label class="text-muted small text-uppercase fw-bold d-block mb-1">Allegati</label>
                <div class="p-3 bg-white border rounded-3 shadow-sm">
                    @if (Model.Allegato != null)
                    {
                        <div class="d-flex align-items-center justify-content-between">
                            <span class="text-primary fw-bold">
                                <i class="fa-solid fa-paperclip me-2"></i> @Model.Allegato.FileName
                            </span>
                            <a href="@Model.PathFileGiaCaricato" target="_blank" class="btn btn-sm btn-primary rounded-pill px-4">
                                <i class="fa-solid fa-download me-1"></i> Scarica
                            </a>
                        </div>
                    }
                    else
                    {
                        <span class="text-muted small">
                            <i class="fa-solid fa-circle-info me-2"></i> Nessun file selezionato
                        </span>
                    }
                </div>
            </div>

            <div class="col-12 mt-4">
                <label class="text-muted small text-uppercase fw-bold d-block mb-1">Descrizione accaduto</label>
                <div class="p-4 bg-white border rounded-4 shadow-sm text-muted" style="line-height: 1.8; border-left: 4px solid #0d6efd !important;">
                    @Model.Descrizione
                </div>
            </div>
        </div>
    </div>

    <div class="text-center mt-5 d-flex flex-column align-items-center gap-3">
        <form id="sendForm" asp-action="InviaDefinitivo" method="post" class="w-100 d-flex flex-column align-items-center gap-3">
            <input type="hidden" asp-for="Categoria" />
            <input type="hidden" asp-for="Luogo" />
            <input type="hidden" asp-for="Reparto" />
            <input type="hidden" asp-for="Descrizione" />
            <input type="hidden" asp-for="DataInvio" />
            <input type="hidden" asp-for="NomeFileGiaCaricato" />
            <input type="hidden" asp-for="PathFileGiaCaricato" />

            <button type="submit" class="btn btn-primary btn-lg custom-btn-large">
                INVIA SEGNALAZIONE
            </button>
        </form>

        <a id="modifyLink"
           asp-controller="Compilazione"
           asp-action="NuovaSegnalazione"
           asp-route-Categoria="@Model.Categoria"
           asp-route-Luogo="@Model.Luogo"
           asp-route-Reparto="@Model.Reparto"
           asp-route-Descrizione="@Model.Descrizione"
           asp-route-DataInvio="@Model.DataInvio.ToString("yyyy-MM-ddTHH:mm")"
           asp-route-NomeFileGiaCaricato="@Model.NomeFileGiaCaricato"
           asp-route-PathFileGiaCaricato="@Model.PathFileGiaCaricato"
           class="btn btn-secondary btn-md custom-btn-small">
            MODIFICA DATI
        </a>
    </div>
</div>

@section scripts {
    <script>

        var allowLeave = false;

  
        document.getElementById("modifyLink").addEventListener("click", function () {
            allowLeave = true;
        });

     
        document.getElementById("sendForm").addEventListener("submit", function () {
            allowLeave = true;
        });


        window.addEventListener("beforeunload", function (e) {
            if (!allowLeave) {
                e.preventDefault();
                e.returnValue = "";
            }
        });
    </script>
}

<style>
    html, body {
        margin: 0;
        padding: 0;
        min-height: 100vh;
    }

    body {
        background: linear-gradient(180deg, #FFFFFF 0%, #ECECEC 91%);
        background-attachment: fixed;
        background-repeat: no-repeat;
    }

    .custom-btn-large {
        background-color: #74a2ff;
        border: none;
        border-radius: 12px;
        min-width: 250px;
        padding: 14px 40px;
    }

    .custom-btn-small {
        background-color: #adb5bd;
        border: none;
        border-radius: 12px;
        min-width: 200px;
        padding: 10px 30px;
        font-size: 0.9rem;
    }
</style>
